<template>
  <v-container class="pa-0 pt-2 ma-0" grid-list-xs fluid>

    <v-data-table
      :headers="headers"
      :items="items"
      hide-actions
      disable-initial-sort
      :pagination.sync="pagination"
      :loading="loading"
      :search="search"
    >
      <template slot="headers" slot-scope="props">
        <tr>
          <th
            v-for="header in props.headers"
            :key="header.text"
            :class="[
              'column sortable',
              pagination.descending ? 'desc' : 'asc',
              header.value === pagination.sortBy ? 'active' : ''
            ]"
            @click="changeSort(header.value)"
            style="padding: 0;"
          >
            <v-icon small>arrow_upward</v-icon>
            {{ header.text }}
          </th>
        </tr>
      </template>
      <template slot="items" slot-scope="props">
        <tr
          @click="viewOrder(props.item)"
          :class="[
            props.item.shipmentsToReceive > 0 ? 'green lighten-4' : '',
            props.item.paymentDetails.paymentStatus === 'denied' ? 'red lighten-4' : ''
          ]"
        >
          <td class="text-xs-center">
            <v-badge color="red" left overlap>
              <span slot="badge" v-if="props.item.shipmentsToReceive > 0">
                {{ props.item.shipmentsToReceive }}
              </span>
              <v-icon color="grey lighten-1">shopping_cart</v-icon>
            </v-badge>
          </td>
          <td class="text-xs-center">{{ props.item.stockOrderReference }}</td>
          <td class="text-xs-center">
            <span v-if="
              (props.item.status.toLowerCase() === 'shipped' ||  props.item.status.toLowerCase() === 'partially shipped') &&
              props.item.shipmentsToReceive > 0"
              >SCHEDULED FOR SHIPPING
            </span>
            <span v-else>{{ props.item.status | uppercase }}</span>
          </td>
          <td class="text-xs-center">
            <span v-if="
                props.item.paymentDetails.paymentStatus === 'pending' &&
                props.item.paymentDetails.paymentType === 'POP'
              "
            >
              {{ 'proof of payment' | uppercase }}
            </span>
            <span v-else>{{ props.item.paymentDetails.paymentStatus | uppercase }}</span>
          </td>
          <td class="text-xs-center">
            {{ props.item.submittedAt | momentify("DD-MMM-YYYY") }}
          </td>
        </tr>
      </template>
    </v-data-table>
  </v-container>
</template>

<script>
import { date } from "@/mixins/date";

export default {
  mixins: [date],

  props: ["items", "search"],

  mounted() {
    this.loading = true;
  },

  data: () => ({
    pagination: {
      sortBy: "submittedAt",
      descending: true,
      rowsPerPage: -1
    },
    loading: false,
    headers: [
      {
        text: "Receivable Shipments",
        value: "",
        sortable: false,
        align: "center"
      },
      {
        text: "Reference No.",
        value: "stockOrderReference",
        align: "center"
      },
      {
        text: "Shipping Status",
        value: "status",
        align: "center"
      },
      {
        text: "Payment Status",
        value: "paymentDetails.paymentStatus",
        align: "center"
      },
      {
        text: "Date Submitted",
        value: "submittedAt",
        align: "center"
      }
    ],
    offsetTop: 0,
  }),

  methods: {
    viewOrder({ id }) {
      this.$router.push({
        name: "ViewStockOrder",
        params: {
          id
        }
      });
    },

    changeSort(column) {
      if (this.pagination.sortBy === column) {
        this.pagination.descending = !this.pagination.descending;
      } else {
        this.pagination.sortBy = column;
        this.pagination.descending = false;
      }
    },
    onScroll (e) {
		this.offsetTop = e.target.scrollTop
		},
  },

  computed: {}
};
</script>

<style scoped>
</style>
